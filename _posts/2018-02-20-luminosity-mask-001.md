---
title: 'Luminosity Mask - How Does It (Really) Works?'
date: 	2018-02-20
author: Fixel Algorithms
layout: post
class:  news
hidden: true
---
![Small Luminosity Mask Icon][1]

Everywhere you go you read about Luminosity Masks.  
I'm really surprised it doesn't have its own Wikipedia Page (Maybe we'll take care of that).  
It is truly a great tool to have in your toolbox, very powerful when used correctly.  
Its greatness by its simplicity.

But how does it works? Not in the sense how to create it, but what really happens?  
Well, let's try answering that and doing it deep (Hopefully interesting).

## The Basics

### Step 001 - It All Starts with a Grayscale Image
You can have image with all the colors in the world but the first step in creating Luminosity Mask is by having a Grayscale image (Single Channel Image).
In most cases it means to calculate the Luminosity Channel of the given image.  
Each one with his own recipe (Most actions / panels based solution uses Photoshop Luminosity selection - `Ctrl + Left Mouse Click` on the RGB Channel in the Channel Tab).

<br/>
![Figure 001][Figure001]{:class="center-img"}
<br/>

By the way, any "Single Channel" image can do here. Namely one could use the Blue channel of RGB image as the base image for the creation of Luminosity Mask.  
Be crazy with that, anything can be a candidate (Yea, even the M channel in CMYK).

Well, in case of a grayscale image, life is easier, one could just step over to Step 002.

### Step 002 - Apply Pixel Wise Transformation on the Grayscale Image

Now, this is the step where the magic happens.  
The idea is very simple, given the Gray Scale image as input the output, per pixel, is a function only of its value.  
Well, this sentence might take some of us back to horrible school days but it is really simple when you think about it.  
Pixel comes in, states its value and gets an output value based only on its value and voilÃ we have a Luminosity Mask.  
The name says it all, the Mask depends solely on the Luminosity (Value) of the pixels.  
It has nothing to do with their location, not their surrounding pixels.  
Just using the Luminosity value. Nothing more, nothing less. Power by simplicity.

<br/>
![Figure 002][Figure002]{:class="center-img"}
<br/>

The above "Mask Generator" seems to be generating a "Midtones Mask" since the output values for Mid Tone Values is high value.  
Simple fact, images are discrete in their values.
For instance, in the case of 8 Bit image, the discrete values are in the range {0, 1, ..., 254, 255}.  
So a *Mask Generator* (Luminosity Mask Generator) has to designate output value for each value in the discrete domain.
Logic says, if the output image is also, let's say 8 Bit, then the output is also within the range {0, 1, ..., 254, 255}.  
In the Computer Science world this process is done using a [Look Up Table](https://en.wikipedia.org/wiki/Lookup_table) (LUT).  

Over time some masks got their own naming according to the properties of the values assigned:  
 *  If it designates high output values to low input values and low values to the rest it is called *Shadows Mask Generator*.  
    The output mask is called *Shadows Luminosity Mask* which reveals shadows and blocks everything elese.
 *  If it designates high output values to mid input values and low values to the rest it is called *Midtones Mask Generator*.  
    The output mask is called *Midtones Luminosity Mask* which reveals midtones and blocks everything elese.
 *  If it designates high output values to high input values and low values to the rest it is called *Highlights Mask Generator*.
    The output mask is called *Highlights Luminosity Mask* which reveals highlights and blocks everything elese.

This is the mask generation transformation (Mapping) and basically this is all theory there is to know.

### Examples
Let's do some stretching by simple example of 2 main building blocks of the Luminosity Mask world.  
We will assume 8 Bit Image hence input and output pixel values are given by {0, 1, 2, ..., 254, 255}.

The most basic Mapping / LUT / Function (All are different names to the same idea) is the identity mapping:

$$ f \left( x \right) = x $$

Namely, the output value is identical to the input value.  
This mask is called "Highlights Luminosity Mask".

Another basic mask is given by the negative (Inverse) of the Highlights Mask which is the Shadows Mask:

$$ f \left( x \right) = 255 - x $$

Using those 2 building blocks one could generate many other masks targeting different Tonal Ranges (Something we will get to later).

<br/>
![Figure 003][Figure003]{:class="center-img"}
<br/>

As can be seen above, the Midtones Mask is generated by scaled multiplication of the Highlights Mask and the Shadows Mask.
This is one way to achieve this, not necessarily what's used usually (We'll talk about that).  
Moreover, as can be seen by the Harmonic Function, one could do any mapping one wish.

**Remark**
In practice, data is scaled into [0, 1] range as operations, such as multiplication, makes more sense in that domain. So the range {0, 1, 2, ..., 254, 255} becomes {0 / 255, 1 / 255, 2 /255, ..., 254 / 255, 255 / 255}. This is exactly what's done in the above figure.

## In Practice
So now we know what a Luminosity Mask Generator is and what is it doing. 
On the next step, let's try to understand how it is done in Photoshop in most cases.  
As discussed above, one need to create a LUT and there 2 main approaches doing so - The Calculations Tool or the Curve Tool.
One can apply each of those on Grayscale Image and the output is basically Luminosity Mask.

### Curve Tool
The [Curve Tool](https://helpx.adobe.com/photoshop/using/curves-adjustment.html) is a Visualized LUT table by a Curve.  
It practically let the user draw the LUT using a flexibe "Curve". 

<br/>
![Figure 004][Figure004]{:class="center-img"}
<br/>

On the figure above, one could see Photoshop's Curve tool.
On its bottom, horizontally, you can see the input values. On the left, vertically, you can see the output value. You match between each value just by altering the curve according to your wish.  
Basically school days function, that's what it is, drawing a function.  

**Luminosity Mask Recipe by Curve Tool**
 1. Create a Grayscale version of the image in a new layer ([Extract Luminosity](https://photoshoptrainingchannel.com/tips/loading-luminosity-keyboard-shortcut/), Select one of the channels, Desaturate the image, Use Channel Mixer, etc...).
 2. Open the Curve Tool.
 3. Draw the desired LUT.
 4. Use the result as a mask -> Luminosity Mask.

### Calculations Tool
Using [Calculations Tool](https://helpx.adobe.com/photoshop/using/channel-calculations.html) one could apply simple math operations on Layer / Channel / etc...  
Namely we can combine math operations (Add, Subtract, Multiply and even more esoteric functions) by repetitive use of the Calculation tool.  
For instance, using the Calculation Tool we could easily generate the Midtones Mask from above by multiplying a layer and its inverse and scaling result by 4.
So it gives us the option to use `+`, `-`, `*`, `/` on images, but not much more than that.

### Comparison - Curve Tool vs. Calculations Tool
Let's summarize the differences between those 2 approaches:
<br/>
<br/>

|               | Curve Tool                                                                                                                                                                       | Calculation Tool                                                                                                                                              |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Advantages    | - No limits what so ever on the shape of the selection. <br/> - Complex mask can be achieved in operation.                                                                        | - Can be translated into exact Mathematical expression. <br/> - Smooth result and gets better as the mode (8, 16, 32 Bit) get higher.                          |
| Disadvatnages | - Photoshop Curves are quantized into 256 [Davide?] levels which makes them less smooth. <br/> - No parameterization (Unless scripted) hence hard to be accurate and consistent. | - Limited to what can be done using the Blend Mode operations on the base Grayscale image. <br/> - Requires repetitive operations to get special selections (Slow). |
| Remarks       | Used by many Luminosity Mask panels out there, yet unless result can be achieved using Calculations, quality wise it is better use Calculations.                                  | Usually used for its quality yet limited either by speed or can get arbitrary selection.                                                                      |

<br/>
<br/>

# Building Masks
In this part we will show how most of the masks out there are built using the Lego bricks we created.

<br/>
![Figure 005][Figure005]{:class="center-img"}
<br/>

As one could see above, using Addition, Subtraction and Multiplication (Intersection), all operations available on Layers / Channels / Masks in Photoshop, one could easily generate all those "Classic" Luminosity Masks one could find in the wild (Wild world of the Luminosity Masks Panels).

Those with "Sharp Eye" would pay attention to something strange - Midtones Mask 001 is all black.  
Yet in practice, in all products out there, it is not?
So what's going on?
Well, what you see above is ideal Masks while Photoshop can not generate them in this quality.
We'll talk more on those pitfalls and strange behavior of classic Luminosity Masks (Their generation) in the next writing.

# Summary
Now we understood what Luminosity Masks really are,  the actual operations and math behind them.  
We have shown the Luminosity Mask generation is no more than the most simple operation on grayscale image - Apply LUT / Pixel Wise Mapping.
What we saw is that there 2 main approaches for Luminosity Masks in Photoshop. While one gives the most flexibility and efficiency (Curve Tool) it lacks with quality and the other which generates smooth masks (Calculation Tool) has speed issues when trying to generate complex masks.
How can we solve those?

Well, this is what Fixel Zone Selector is all about.  
In the next part we'll talk about Zone Selector approach to Luminosity Masks.


## Image Credit
 *  [Lighthouse Image](https://www.flickr.com/photos/magnetismus/8399258607/) - Credit to [magnetismus](https://www.flickr.com/people/magnetismus/).
 *  [Schwaigsee Lake] - Credit to [Alfred Borchard](https://www.freeimages.com/photographer/Alfi007-51075).
 *  [Simple Living](https://www.flickr.com/photos/lightsamples/22552453147) - Credit to [Malcolm Carlaw](https://www.flickr.com/photos/lightsamples/).


## Resources
 * https://fstoppers.com/education/how-create-luminosity-masks-better-retouching-111111 for Luminosity Mask using Calculations.
 * https://www.capturelandscapes.com/introduction-to-luminosity-masks/.
 * https://fstoppers.com/composite/create-seamless-selections-using-luminosity-masks-159068.
 * https://www.psdbox.com/tutorials/complex-masking-using-channels-and-calculations.
 * https://www.youtube.com/watch?v=t3zSUK7KK7c
 * https://www.youtube.com/watch?v=htuf4yaanBI
 * http://play.macprovideo.com/photoshop-102-selection-masking-techniques/12
 * https://www.youtube.com/watch?v=QUkIgdmnBaE
 * http://fotographee.com/luminosity-masks-gradient/ (See shortcuts for operations on Masks)

Key Words: [Fixel Algorithms][2], [Fixel][2], [Fixel Zone Selector][2], [Luminosity Mask][2],  [Luminosity Masks][2], [Saturation Mask][2], [Saturation Masks][2], [Curves][2], [Levels][2], [Luminosity][2], [Photoshop][2], [Plug In][2].


<!-- This is commented out -->
  [1]: https://i.imgur.com/PwWqBlg.png
  [2]: {{site.baseurl}}products/zoneselector/ "Fixel Zone Selector 1 PS Product Page"
  [3]: http://www.davidebarranca.com "Davide Barranca - Photoshop, etc."
  [4]: http://www.davidebarranca.com/2012/09/decomposing_sharpening_part_1/ "Decomposing Sharpening #1 Introduction"
  [5]: http://www.davidebarranca.com/2013/01/double-usm-photoshop-sharpening-script-1-introduction/ "Double USM Photoshop Sharpening Script #1: Introduction"
  [6]: {{site.baseurl}}/news/images/FixelEdgeHancer2/SharpeningInputImageAnimated.png "Classic Image Sharpening"
  [7]: {{site.baseurl}}/news/images/FixelEdgeHancer2/EdgeMaskRadiusAnalysisAnimated.png "Fixel EdgeHancer Edge Mask"
  [8]: https://unsplash.com/photos/rNBYe4QlAIQ "Image by Tanja Heffner"
  [Figure001]: https://i.imgur.com/lkpRRXR.png "Figure 001 - Extracting Luminosity Channel from RGB Image"
  [Figure002]: https://i.imgur.com/wkEQyn9.png "Figure 002 - Mapping Grayscale Image into Luminosity Mask"
  [Figure003]: https://i.imgur.com/Dl1xPBP.png
  [Figure004]: https://i.imgur.com/VNpLV0c.png
  [Figure005]: https://i.imgur.com/n2zTX8S.png

